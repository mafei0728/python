[TOC]

# 第9天 以b模式处理文件,迭代器,生成器

```shell
#基础知识见之前的的笔记
```

## 1.以b模式打开一个文件                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                               

```python
#!/usr/bin/env python
# -*- coding: utf-8 -*-
#auther:mafei0728
f = open("2","rb") #b的方式不能指定编码
c = f.read()
print(c.decode("utf8")) ------编码转化为utf-8的编码
```

## 2.以b模式写入一个文件

```python
#!/usr/bin/env python
# -*- coding: utf-8 -*-
#auther:mafei0728
# f = open("2","rb")
# c = f.read()
# print(c.decode("utf8"))
x = "mafei0728"
y = bytes(x,encoding="utf8")
#字符串转化成字节被称为编码(encode)
#字节转换成字符串被称为解码(decode)
#编码解码都要指定格式
f = open("3","wb")
f.write(y)
```

## 3.ab以追加的模式写入一个文件

```python
#!/usr/bin/env python
# -*- coding: utf-8 -*-
#auther:mafei0728
# f = open("2","rb")
# c = f.read()
# print(c.decode("utf8"))
x = "hello"
y = bytes(x,encoding="utf8")
#字符串转化成字节被称为编码(encode)
#字节转换成字符串被称为解码(decode)
#编码解码都要指定格式
f = open("3","ab")
f.write(y)
```

## 4.文件操作的方法

```python
见之前的基础知识笔记
#!/usr/bin/env python
# -*- coding: utf-8 -*-
#auther:mafei0728
f = open("1","r+",encoding="utf8")
print(f.readlines())
f.close()
g = open("1","r+",encoding="utf8",newline="") #指定newline后,将按系统的来处理,不然默认\n处理
print(g.readlines())
g.close()



#!/usr/bin/env python
# -*- coding: utf-8 -*-
#auther:mafei0728
f = open("1","r+",encoding="utf8")
print(f.read(3))  #读几个"字符"

```

## 5. seek 高级用法

```python
#!/usr/bin/env python
# -*- coding: utf-8 -*-
#auther:mafei0728
f = open("1","rb")
f.seek(10,1)
#seek如果有带1的参数,表示从相对位置(上一次的位置)来移动光盘
#相对位置移动的时候最好以二进制的方法来读
f.seek(3,1)
print(f.tell())
f.seek(-11,2) #2代表从文件末尾开始,应该负数往回读,正数没意义
print(f.read().decode("utf8"))
```

```shell
#!/usr/bin/env python
# -*- coding: utf-8 -*-
#auther:mafei0728
#读大文件的最后一行
f = open("1","rb") #2进制形式打开,不怕中文报错
offs = -12 #预估一个偏移量
while True:
        f.seek(offs,2)#倒着读
        file_4 = f.readlines()
        if len(file_4) > 1:#大于1表示读到前面的行了
            print(file_4[-1].decode("utf-8"))
            break
        offs *=2
```

## 6.迭代器和生成器

```shell
1.什么是迭代?
每次循环得到的结果都是依赖上一次结果来的
2.迭代器协议指?
对象不许提供一个next方法,执行该方法要么返回迭代中的下一项,要么就引起一个stoplteration异常,以终止迭代
3.可迭代对像?
实现迭代器协议的对象
4.协议就是一种规定,可迭代对象实现了迭代的协议,python内部用迭代器协议访问对象
```

```python
字符串,列表,元组,字典,集合,文件都能被for循环遍历的对象,但是他们没有next方法不能称为可迭代的对象,只是内部调用了_iter_()方法
#!/usr/bin/env python
# -*- coding: utf-8 -*-
#auther:mafei0728
a = [1,2,3,4,5,6,7]
b = a.__iter__()
print(b.__next__())
​`````
for循环内部其实就在做上面的操作
直接捕捉的StopIteration异常就结束
for循环跟索引完全没有关系
while能遍历有序对象,但不循环集合和字典
```

补充

```python
a = [1,2,3,4,5]
b = a.__iter__()
b被称为迭代器,或者可迭代对象

```

## 7.生成器

```python
可以理解为一种数据类型,这种数据类型自动实现了迭代器协议,生成器就是可迭代对象
生成器在python中有两种表现形式,
1.生成器函数
def test():
    yield 1 #函数的返回值用yield就表示生成器函数,可以返回多个值
    yield 1
    yield 1
g = test()
print(g)
print(g.__next__())
<generator object test at 0x0000000002176A40>
1
2.生成器表达式
```

```python
#三元表达式
name = "mafei0728"
"hello" if name == "mafei0728" else "helloo"
a = "hello" if name == "mafei0728" else "helloo"
print(a)
-------------------------------------


```

